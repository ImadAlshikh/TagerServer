generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum UserRoles {
  USER
  ADMIN
  SUPPORT
}

enum PostStatus {
  ACTIVE
  SOLD
  EXPIRED
  HIDDING
  REMOVED
}

enum PostType {
  PRODUCT
  SERVICE
}

enum SaleType {
  ONETIME
  MULTIPLE
}

model User {
  id             String    @id @default(cuid())
  googleId       String?   @unique
  name           String
  surname        String?
  email          String    @unique
  password       String?
  phone          String?
  picture        String?
  role           UserRoles @default(USER)
  posts          Post[]
  country        String?
  ratingsGiven   Rating[]  @relation("rater_user")
  ratingsRecived Rating[]  @relation("rated_user")
  chats          Chat[]
  messages       Message[]
  created_at     DateTime  @default(now())
  reports        Report[]  @relation("report")
}

model Post {
  id          String     @id @default(cuid())
  title       String
  description String?
  category    String?
  picture     String?
  price       Float
  discount    Int?
  type        PostType   @default(PRODUCT)
  saleType    SaleType   @default(ONETIME)
  stock       Int?
  status      PostStatus @default(ACTIVE)
  country     String?
  address     String?
  chats       Chat[]
  owner       User       @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  ownerId     String
  created_at  DateTime   @default(now())
}

model Chat {
  id         String    @id @default(cuid())
  messages   Message[]
  user       User      @relation(fields: [userId], references: [id])
  userId     String
  post       Post      @relation(fields: [postId], references: [id], onDelete: Cascade)
  postId     String
  created_at DateTime  @default(now())

  @@unique([userId, postId])
}

model Message {
  id         String   @id @default(cuid())
  text       String
  sender     User     @relation(fields: [senderId], references: [id], onDelete: Cascade)
  senderId   String
  chat       Chat     @relation(fields: [chatId], references: [id])
  chatId     String
  created_at DateTime @default(now())
}

model Rating {
  id      String  @id @default(cuid())
  text    String?
  rate    Int
  raterId String
  rater   User    @relation(name: "rater_user", fields: [raterId], references: [id], onDelete: Cascade)
  ratedId String
  rated   User    @relation(name: "rated_user", fields: [ratedId], references: [id], onDelete: Cascade)

  @@unique([raterId, ratedId])
}

model Report {
  id         String   @id @default(cuid())
  reporterId String
  reporter   User     @relation(name: "report", fields: [reporterId], references: [id], onDelete: Cascade)
  reportedId String
  text       String?
  created_at DateTime @default(now())
}
