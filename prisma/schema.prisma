generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum UserRoles {
  USER
  ADMIN
  SUPPORT
}

enum PostStatus {
  ACTIVE
  SOLD
  EXPIRED
  HIDDING
  REMOVED
}

enum SaleType {
  ONETIME
  MULTIPLE
}

model User {
  id             String    @id @default(cuid())
  googleId       String?   @unique
  name           String
  surname        String?
  bio            String?
  email          String    @unique
  password       String?
  phone          String?
  pictureId      String?   @unique
  picture        Image?    @relation(fields: [pictureId], references: [id])
  role           UserRoles @default(USER)
  posts          Post[]
  address        String?
  ratingsGiven   Rating[]  @relation("rater_user")
  ratingsRecived Rating[]  @relation("rated_user")
  chats          Chat[]
  messages       Message[]
  created_at     DateTime  @default(now())
}

model Post {
  id           String     @id @default(cuid())
  title        String
  description  String?
  picture      String?
  price        Int //in cents
  discount     Int?
  saleType     SaleType   @default(ONETIME)
  stock        Int?
  status       PostStatus @default(ACTIVE)
  tags         String[]
  country      String?
  address      String?
  chats        Chat[]
  owner        User       @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  ownerId      String
  created_at   DateTime   @default(now())
  category     Category   @relation(fields: [categoryName], references: [name])
  categoryName String
}

model Chat {
  id         String    @id @default(cuid())
  messages   Message[]
  user       User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId     String
  post       Post      @relation(fields: [postId], references: [id], onDelete: Cascade)
  postId     String
  created_at DateTime  @default(now())

  @@unique([userId, postId])
}

model Message {
  id         String   @id @default(cuid())
  isRead     Boolean  @default(false)
  text       String
  sender     User     @relation(fields: [senderId], references: [id], onDelete: Cascade)
  senderId   String
  chat       Chat     @relation(fields: [chatId], references: [id], onDelete: Cascade)
  chatId     String
  created_at DateTime @default(now())
}

model Image {
  id        String  @id @default(cuid())
  publicId  String?
  secureUrl String
  user      User?
}

model Category {
  id         String   @id @default(cuid())
  name       String   @unique
  posts      Post[]
  created_at DateTime @default(now())
}

model Rating {
  id      String  @id @default(cuid())
  text    String?
  rate    Int
  raterId String
  rater   User    @relation(name: "rater_user", fields: [raterId], references: [id], onDelete: Cascade)
  ratedId String
  rated   User    @relation(name: "rated_user", fields: [ratedId], references: [id], onDelete: Cascade)

  @@unique([raterId, ratedId])
}

model Report {
  id         String   @id @default(cuid())
  reporterId String
  reportedId String
  text       String?
  created_at DateTime @default(now())
  userId     String?

  @@unique([reporterId, reportedId])
}
